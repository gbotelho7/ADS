<!DOCTYPE html>
<html>
<head>
  <title>Carregamento de CSV com Papa Parse e Tabulator</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.0.5/css/tabulator.min.css" rel="stylesheet">
</head>
<body>
  
  <script>
    let jsonData;
    let csvSeparator = ';';
    let expectedHeaders = "Curso,Unidade de execução,Turno,Turma,Inscritos no turno,Dia da Semana,Início,Fim,Dia,Características da sala pedida para a aula,Sala da aula,Lotação,Características reais da sala";
    let expectedHeadersArray = expectedHeaders.split(',');
  </script>

  <input type="file" id="csvFileInput">
  <div id="csvData"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.0.5/js/tabulator.min.js"></script>
  <script>

    document.getElementById("csvFileInput").addEventListener("change", function (e) {
      const file = e.target.files[0];

      if (file) {
        Papa.parse(file, {
          delimiter: csvSeparator,
          header: true,
          complete: function (results) {
            jsonData = results.data;
            const csvDataDiv = document.getElementById("csvData");

            const headersMatch = expectedHeadersArray.every((header) => results.meta.fields.includes(header.trim()));


            if (headersMatch) {

              // Limpa qualquer conteúdo anterior
              csvDataDiv.innerHTML = "";

              // Crie um elemento de tabela para exibir os dados com Tabulator
              const table = document.createElement("div");
              table.setAttribute("id", "csvTable");
              csvDataDiv.appendChild(table);


              new Tabulator("#csvTable", {
                data: jsonData,
                layout: "fitData",
                autoColumns: true,
                pagination: "local",
                paginationSize: 7,
              });
            } else {
              // Notifique o usuário que os cabeçalhos não correspondem
              alert("Os cabeçalhos do CSV não correspondem aos esperados. Insira as alterações necessárias");
            }
          }
        });
      }
    });
  </script>
</body>
</html>
